# Delta Lake Sink Connector Configuration Example (v0.2.0)

# Danube Connection Settings
danube_service_url = "http://localhost:6650"
connector_name = "deltalake-sink-example"
metrics_port = 9090

# Delta Lake Configuration
[deltalake]
# Storage backend: "s3", "azure", or "gcs"
storage_backend = "s3"

# S3/MinIO Configuration
s3_region = "us-east-1"
s3_endpoint = "http://localhost:9000"  # MinIO endpoint
s3_allow_http = true  # Required for MinIO

# AWS credentials from environment variables:
# AWS_ACCESS_KEY_ID
# AWS_SECRET_ACCESS_KEY

# Global batch settings (can be overridden per topic)
batch_size = 100  # High batch size - rely on flush interval
flush_interval_ms = 3000  # Flush every 3 seconds if batch not full

# Topic Mapping: Danube topic → Delta Lake table
[[deltalake.topic_mappings]]
# Danube topic to consume from
topic = "/default/events"

# Subscription name (for consumer group)
subscription = "deltalake-sink-sub"

# Delta table path (S3 URI format)
delta_table_path = "s3://delta-tables/events"

# Write mode: "append" (default) or "overwrite"
write_mode = "append"

# Include Danube metadata in each record
# Adds _danube_metadata JSON column with topic, offset, timestamp
include_danube_metadata = true

# Schema validation - schema is created by producer/admin
# This validates incoming messages against the registered schema
expected_schema_subject = "events-schema-v1"

# Field mappings: Extract JSON fields → Delta Lake columns
# The runtime provides pre-deserialized JSON payloads
field_mappings = [
    { json_path = "event_type", column = "event_type", data_type = "Utf8", nullable = false },
    { json_path = "user_id", column = "user_id", data_type = "Utf8", nullable = false },
    { json_path = "timestamp", column = "timestamp", data_type = "Utf8", nullable = false },
    { json_path = "product", column = "product", data_type = "Utf8", nullable = true },
    { json_path = "amount", column = "amount", data_type = "Int64", nullable = true },
    { json_path = "currency", column = "currency", data_type = "Utf8", nullable = true },
]

# Optional: Override global batch settings for this specific topic
# batch_size = 50
# flush_interval_ms = 500
